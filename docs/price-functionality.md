# Функциональность управления ценами товаров

## Обзор

В системе MedSIP Prosthetics реализована гибкая система управления ценами товаров, которая позволяет:

- Назначать цену товару при создании и редактировании
- Устанавливать цену со скидкой
- Скрывать/показывать цену на сайте
- Продавать товары "по запросу" без указания цены

## Основные возможности

### 1. Назначение цены

**Всегда доступно при редактировании товара:**
- Цена не является обязательным полем
- Можно оставить пустой для товаров "по запросу"
- Максимальное значение: 99,999,999.99 ₽
- Поддерживает копейки (до 2 знаков после запятой)

### 2. Цена со скидкой

- Опциональное поле
- Должна быть меньше основной цены
- Автоматически рассчитывается процент скидки
- Показывается экономия в рублях

### 3. Управление отображением

**Переключатель "Не показывать цену на сайте":**
- ✅ Включено: показывается "По запросу"
- ❌ Выключено: цена отображается на сайте

## Интерфейс администратора

### Расположение

Настройки цен находятся в форме редактирования товара:
- **Вкладка:** "Основное"
- **Секция:** "Цены и отображение"

### Поля формы

1. **Цена** - основная цена товара
2. **Цена со скидкой** - цена с учетом скидки (опционально)
3. **Не показывать цену на сайте** - переключатель отображения

### Валидация

- Цена должна быть положительным числом
- Максимальное значение: 99,999,999.99
- Цена со скидкой должна быть меньше основной цены
- Некорректные форматы отклоняются

## API

### Создание товара

```javascript
POST /api/products
{
  "name": "Протез руки",
  "price": 50000,
  "discount_price": 45000,
  "show_price": true
}
```

### Обновление товара

```javascript
PUT /api/products/123
{
  "price": 55000,
  "discount_price": null,
  "show_price": false
}
```

### Товар без цены (по запросу)

```javascript
{
  "price": null,
  "discount_price": null,
  "show_price": false
}
```

## Примеры использования

### 1. Обычный товар с ценой
```
Цена: 50,000 ₽
Не показывать на сайте: Нет
Результат: На сайте отображается "50,000 ₽"
```

### 2. Товар со скидкой
```
Цена: 50,000 ₽
Цена со скидкой: 40,000 ₽
Не показывать на сайте: Нет
Результат: На сайте "40,000 ₽" (скидка 20%)
```

### 3. Товар "по запросу"
```
Цена: не указана
Не показывать на сайте: Да
Результат: На сайте "По запросу"
```

### 4. Скрытая цена
```
Цена: 50,000 ₽
Не показывать на сайте: Да
Результат: На сайте "По запросу" (цена есть в системе, но скрыта)
```

## Технические детали

### База данных

Поля в таблице `products`:
- `price` - DECIMAL(10,2) NULL
- `discount_price` - DECIMAL(10,2) NULL  
- `show_price` - BOOLEAN DEFAULT true

### Компоненты

- `ProductPricingSection` - секция управления ценами
- `ProductFormModern` - основная форма товара
- `useProductForm` - хук для работы с формой

### Валидация

- Клиентская валидация в React компонентах
- Серверная валидация в API роутах
- Проверка максимальных значений и форматов

## Тестирование

Для тестирования функциональности запустите:

```bash
node test-price-functionality.js
```

Тест проверяет:
- Назначение различных типов цен
- Валидацию некорректных значений
- Сохранение и восстановление данных