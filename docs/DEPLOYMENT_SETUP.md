# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π–º–µ–Ω—Çt —á–µ—Ä–µ–∑ GitHub Webhook

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Webhook

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –≤ GitHub

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub
2. –í—ã–±–µ—Ä–∏—Ç–µ "Webhooks" –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é
3. –ù–∞–∂–º–∏—Ç–µ "Add webhook"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **Payload URL**: `https://your-domain.com/api/webhook/github`
   - **Content type**: `application/json`
   - **Secret**: `venorus_webhook_secret_2025` (–∏–∑ .env.local)
   - **Events**: –í—ã–±–µ—Ä–∏—Ç–µ "Just the push event"
   - **Active**: –í–∫–ª—é—á–µ–Ω–æ

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env.local` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç:

```env
GITHUB_WEBHOOK_SECRET="venorus_webhook_secret_2025"
```

### 3. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–∏ push –≤ –≤–µ—Ç–∫—É `main`/`master` GitHub –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
2. –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/webhook/github` –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ça
5. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
   - `git fetch origin` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - `git reset --hard origin/main` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
   - `npm ci` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - `npm run build` - —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
   - `npm run lint` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–∏–Ω–≥–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
   - `pm2 restart venorus` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞
   - –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ Next.js

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–∞–π–ª `logs/deploy.log`:

```
[2025-08-17T12:00:00.000Z] üöÄ ===== STARTING AUTOMATIC DEPLOYMENT =====
[2025-08-17T12:00:01.000Z] üîÑ Fetching latest changes...
[2025-08-17T12:00:02.000Z] ‚úÖ Fetching latest changes completed
...
[2025-08-17T12:00:30.000Z] üéâ ===== DEPLOYMENT COMPLETED SUCCESSFULLY in 30.00s =====
```

### 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Webhook –∑–∞—â–∏—â–µ–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å HMAC SHA256
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ push –≤ main/master –≤–µ—Ç–∫—É
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç

### 6. –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π–º–µ–Ω—Çt

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π–º–µ–Ω—Çt –≤—Ä—É—á–Ω—É—é:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π–º–µ–Ω—Çt
npm run deploy:auto

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
npm run deploy:manual
```

### 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook endpoint:

```bash
curl https://your-domain.com/api/webhook/github
```

–û—Ç–≤–µ—Ç:
```json
{
  "message": "GitHub Webhook Endpoint",
  "status": "active",
  "timestamp": "2025-08-17T12:00:00.000Z"
}
```

### 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2 (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PM2, —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `ecosystem.config.js`:

```javascript
module.exports = {
  apps: [{
    name: 'venorus',
    script: 'npm',
    args: 'start',
    instances: 1,
    autorestart: true,
    watch: false,
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
}
```

–ó–∞–ø—É—Å–∫ —Å PM2:
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### 9. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**Webhook –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ —Å–µ–∫—Ä–µ—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö GitHub
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/deploy.log`

**–î–µ–ø–ª–æ–π–º–µ–Ω—Çt –ø–∞–¥–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ `logs/deploy.log`

**–û—Ç–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —á–∏—Å—Ç—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞

### 10. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –¥–ª—è Windows

–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows, –∑–∞–º–µ–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ `auto-deploy.js`:

```javascript
// –ó–∞–º–µ–Ω–∏—Ç—å
await runCommand('pm2 restart venorus', 'Restarting PM2 process')

// –ù–∞ (–¥–ª—è Windows —Å IIS –∏–ª–∏ –¥—Ä—É–≥–∏–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º)
await runCommand('iisreset', 'Restarting IIS')
```