# Система заказов - Руководство пользователя

## Обзор

Система заказов позволяет пользователям оформлять заказы на протезы и ортезы прямо на сайте, а администраторам - управлять этими заказами через админ панель.

## Функциональность для пользователей

### 1. Добавление товаров в корзину
- На главной странице или странице товара нажмите кнопку "Добавить в корзину"
- Товар будет добавлен в корзину, которая отображается в шапке сайта
- Количество товаров в корзине показывается в бейдже на иконке корзины

### 2. Управление корзиной
- Нажмите на иконку корзины в шапке для открытия корзины
- В корзине можно:
  - Изменить количество товаров (+ / -)
  - Удалить товары (корзина)
  - Очистить всю корзину
  - Перейти к оформлению заказа

### 3. Оформление заказа
- В корзине нажмите кнопку "Оформить заказ"
- Заполните форму с контактными данными:
  - **Номер телефона** (обязательно) - для связи по WhatsApp или звонка
  - **Email адрес** (обязательно) - для отправки информации о заказе
  - **Комментарий** (опционально) - дополнительные пожелания
- Проверьте итоги заказа
- Нажмите "Подтвердить заказ"

### 4. Консультация в WhatsApp
- В корзине есть кнопка "Консультация в WhatsApp"
- При нажатии откроется WhatsApp с готовым сообщением, содержащим:
  - Список товаров в корзине
  - Количество и цены
  - Общую сумму
  - Просьбу о консультации

## Функциональность для администраторов

### 1. Доступ к заказам
- Войдите в админ панель (`/admin`)
- На главной странице админ панели нажмите кнопку "Заказы" в разделе "Быстрые действия"
- Или перейдите напрямую по адресу `/admin/orders`

### 2. Просмотр списка заказов
В разделе заказов доступны:
- **Поиск** по номеру заказа, телефону или email
- **Фильтрация** по статусу заказа
- **Таблица заказов** с информацией:
  - Номер заказа
  - Контактные данные клиента
  - Количество товаров
  - Общая сумма
  - Статус заказа
  - Дата создания

### 3. Управление заказом
- Нажмите кнопку "Просмотр" для открытия деталей заказа
- В окне деталей заказа можно:
  - Просмотреть информацию о клиенте
  - Увидеть список товаров в заказе
  - Изменить статус заказа
  - Добавить комментарий к заказу
  - Сохранить изменения

### 4. Статусы заказов
- **Ожидает** - новый заказ, требует обработки
- **Подтвержден** - заказ подтвержден с клиентом
- **В обработке** - заказ находится в работе
- **Отправлен** - заказ отправлен клиенту
- **Доставлен** - заказ успешно доставлен
- **Отменен** - заказ отменен

## Техническая информация

### База данных
Система использует две таблицы PostgreSQL:

#### Таблица `orders`
```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    customer_phone VARCHAR(20) NOT NULL,
    customer_email VARCHAR(255) NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL,
    status VARCHAR(50) DEFAULT 'pending' NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    notes TEXT
);
```

#### Таблица `order_items`
```sql
CREATE TABLE order_items (
    id SERIAL PRIMARY KEY,
    order_id INTEGER NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    product_id VARCHAR(255) NOT NULL,
    product_name VARCHAR(255) NOT NULL,
    product_price DECIMAL(10, 2) NOT NULL,
    product_image_url TEXT,
    quantity INTEGER NOT NULL DEFAULT 1,
    total_price DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### API Endpoints

#### Создание заказа
```
POST /api/orders
Content-Type: application/json

{
  "customer_phone": "+7 (495) 123-45-67",
  "customer_email": "customer@example.com",
  "total_amount": 150000.00,
  "notes": "Комментарий к заказу",
  "items": [
    {
      "product_id": "product-1",
      "product_name": "Протез руки",
      "product_price": 75000.00,
      "product_image_url": "https://example.com/image.jpg",
      "quantity": 1,
      "total_price": 75000.00
    }
  ]
}
```

#### Получение списка заказов
```
GET /api/orders?page=1&limit=10&status=pending
```

#### Получение деталей заказа
```
GET /api/orders/{id}
```

#### Обновление заказа
```
PUT /api/orders/{id}
Content-Type: application/json

{
  "status": "confirmed",
  "notes": "Заказ подтвержден с клиентом"
}
```

## Дизайн

Система заказов выполнена в едином стиле Tiffany с:
- Градиентами от cyan до blue
- Эффектами стекла (backdrop-blur)
- Скругленными углами
- Тенями в стиле Tiffany
- Анимациями при наведении

## Безопасность

- Валидация данных на клиенте и сервере
- Проверка корректности email и телефона
- Использование транзакций для целостности данных
- Защита от SQL инъекций через параметризованные запросы

## Поддержка

При возникновении проблем с системой заказов обратитесь к разработчикам или проверьте логи сервера для диагностики ошибок. 